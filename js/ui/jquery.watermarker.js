(function(b){b.Watermarker=function(c,i){function j(){d.width(e.width());d.height(e.height());var a=f(g.css("borderLeftWidth")),q=f(g.css("borderRightWidth")),b=f(g.css("borderTopWidth")),c=f(g.css("borderBottomWidth"));g.width(e.width()-a-q);g.height(e.height()-b-c)}function f(a){return parseInt(a.replace("px",""))}function k(){var m=n(d),b=n(p);a.onChange({x:m[0]-b[0],y:m[1]-b[1],w:d.width(),h:d.height(),opacity:a.opacity})}function n(a){a=b(a).offset();return[a.left,a.top]}"object"!==typeof c&&
(c=b(c)[0]);"object"!==typeof i&&(i={});var a={watermark_img:"watermark.png",opacity:1,opacitySlider:null,x:null,y:null,w:null,h:null,position:null,onChange:function(){},onSelect:function(){}},l=i;"object"!=typeof l&&(l={});a=b.extend(a,l);"function"!==typeof a.onChange&&(a.onChange=function(){});"function"!==typeof a.onSelect&&(a.onSelect=function(){});var h=b(c),p=b("<div />").width(h.width()).height(h.height()).css({position:"relative"}).insertAfter(h);p.append(h);var e=b("<div />").resizable({resize:function(){j();
k()},containment:"parent"}).draggable({drag:function(){k()},containment:"parent"}).css({position:"absolute"}).insertAfter(h),g=b("<div />").addClass("watermark").css({position:"absolute","z-index":1});e.append(g);var d=b("<img />").attr("src",a.watermark_img).addClass("watermark").css({position:"absolute","z-index":2}).load(function(){var b=Math.round(h.width()/2-d.width()/2),c=Math.round(h.height()/2-d.height()/2),f=h.height()-d.height(),g=h.width()-d.width();if(null!=a.x&&null!=a.y)b=a.x,c=a.y;
else if(null!=a.position)switch(a.position){case "topleft":c=b=0;break;case "topcenter":c=0;break;case "topright":b=g;c=0;break;case "centerleft":b=0;break;case "centerright":b=g;break;case "bottomleft":b=0;c=f;break;case "bottomcenter":c=f;break;case "bottomright":b=g,c=f}e.css({top:c+"px",left:b+"px"});e.width(null==a.w?d.width():a.w);e.height(null==a.h?d.height():a.h);j();e.css({opacity:a.opacity,filter:"alpha(opacity="+100*a.opacity+")"});k()});e.append(d);null!==a.opacitySlider&&a.opacitySlider.slider({min:0,
max:100,value:100*a.opacity,slide:function(b,c){a.opacity=c.value/100;e.css({opacity:a.opacity,filter:"alpha(opacity="+100*a.opacity+")"});k()}})};b.fn.Watermarker=function(c){"object"!==typeof c&&(c={});this.each(function(){if(b(this).data("Watermarker")){if("api"==c)return b(this).data("Watermarker");b(this).data("Watermarker").setOptions(c)}else{var i=this,j=c.useImg||i.src,f=new Image;f.onload=function(){b.Watermarker(i,c)};f.src=j}});return this}})(jQuery);
